<?php

require __DIR__ . '/vendor/autoload.php';

use BapCat\Phi\Phi;
use BapCat\Persist\Drivers\Filesystem\FilesystemDriver;
use BapCat\Remodel\RemodelTemplateFinder;
use Illuminate\Database\MySqlConnection;

$ioc = Phi::instance();

$ioc->bind(RemodelTemplateFinder::class, function() {
  // Grab filesystem directories
  $persist = new FilesystemDriver(__DIR__);
  $compiled  = $persist->get('/cache');
  
  // TemplateFinders are able to find and use raw/compiled templates
  return new RemodelTemplateFinder($compiled);
});

$pdo = new PDO('mysql:host=localhost;dbname=test', 'root', '');
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

$connection = new MySqlConnection($pdo, 'test');
